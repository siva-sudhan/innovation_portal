{% extends 'base.html' %}

{% block title %}Submit Idea{% endblock %}

{% block head_extra %}
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block content %}
  <div class="idea-form-wrapper animate-fade-in">
    <h2 class="form-title">üìù Submit a New Idea</h2>

    <form method="POST" class="idea-form">
      {{ form.hidden_tag() }}

      <div class="form-group">
        {{ form.title.label }}<br>
        {{ form.title(class="input", placeholder="e.g., AI-powered diagnostics for engines") }}
        {% if form.title.errors %}
          <div class="error">{{ form.title.errors[0] }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        {{ form.description.label }}<br>
        <div id="quill-editor" style="height: 200px;"></div>
        {{ form.description(class="textarea", style="display:none;") }}
        {% if form.description.errors %}
          <div class="error">{{ form.description.errors[0] }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        {{ form.teammates.label }}<br>
        {{ form.teammates(class="input", placeholder="Optional ‚Äì List teammates, comma-separated") }}
        {% if form.teammates.errors %}
          <div class="error">{{ form.teammates.errors[0] }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        {{ form.intent.label }}<br>
        {{ form.intent(class="input") }}
        {% if form.intent.errors %}
          <div class="error">{{ form.intent.errors[0] }}</div>
        {% endif %}
      </div>

      <div class="form-group checkbox">
        {{ form.is_anonymous() }}
        {{ form.is_anonymous.label }}
        <span class="hint">We'll hide your name if this is checked.</span>
      </div>

      <div class="form-group">
        {{ form.submit(class="submit-button") }}
      </div>
    </form>
</div>
  <div class="live-stats-wrapper">
    <h3 class="stats-title">üìà Live Innovation Stats</h3>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="stat-ideas">0</div>
        <div class="stat-label">Ideas Submitted</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-users">0</div>
        <div class="stat-label">Unique Users</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-votes">0</div>
        <div class="stat-label">Total Votes</div>
      </div>
    </div>
  </div>
{% block scripts %}
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script>
    var quill = new Quill('#quill-editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ list: 'bullet' }],
          [{ align: [] }],
          ['clean']
        ]
      }
    });

    document.querySelector('.idea-form').addEventListener('submit', function () {
      var descField = document.querySelector('textarea[name="description"]');
      descField.value = quill.root.innerHTML;
    });

    async function fetchStats() {
      try {
        const res = await fetch('/api/stats');
        const data = await res.json();
  
        document.getElementById('stat-ideas').textContent = data.ideas;
        document.getElementById('stat-users').textContent = data.users;
        document.getElementById('stat-votes').textContent = data.votes;
      } catch (err) {
        console.error("Failed to fetch stats", err);
      }
    }
  
    fetchStats();
    setInterval(fetchStats, 5000); // Update every 5 seconds
  </script>
{% endblock %}

{% endblock %}
