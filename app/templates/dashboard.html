{% extends 'base.html' %}

{% block title %}Innovation Hub – Dashboard{% endblock %}

{% block content %}
  <div class="dashboard-header">
    <h2>🗂️ Submitted Ideas</h2>
    <p class="idea-count">🚀 {{ unique_user_count }} unique users have submitted ideas so far</p>

    {% if session.username %}
      <p class="welcome">Welcome <strong>{{ session.username }}</strong></p>
      <span class="badge {{ session.role }}">
        {{ session.role|capitalize }}
      </span>
    {% endif %}
  </div>

  {% if ideas %}
    <div class="idea-grid">
      {% for idea in ideas %}
        <div class="idea-card animate-fade-in">
          <h3>{{ idea.title }}</h3>
          <p class="tags">
            {% for tag in idea.tags.split(',') %}
              <span class="tag">{{ tag.strip() }}</span>
            {% endfor %}
          </p>
          <p><strong>Submitted:</strong> {{ idea.timestamp.strftime('%Y-%m-%d %H:%M') }}</p>
          <p><strong>By:</strong> {{ 'Anonymous' if idea.is_anonymous else idea.submitter }}</p>
          <p><strong>Votes:</strong> {{ idea.votes }}</p>

          <div class="vote-section">
            {% if idea.id in voted_ideas %}
              <p class="voted-msg">✅ You voted</p>
            {% else %}
              <form method="POST" action="{{ url_for('views.vote', idea_id=idea.id) }}">
                {{ vote_form.hidden_tag() }}
                {{ vote_form.submit(class="vote-btn") }}
              </form>
            {% endif %}
          </div>
          {% if not idea.is_anonymous and idea.submitter and idea.submitter != session.username %}
            <p>
                <a href="{{ generate_teams_link(idea.submitter) }}" target="_blank" class="connect-btn">💬 Chat on Teams</a>
            </p>
          {% endif %}
          <p><a href="{{ url_for('views.idea_detail', idea_id=idea.id) }}">🔍 View Details</a></p>

          {% if session.role == 'admin' %}
            <div class="admin-actions">
              <a href="{{ url_for('views.edit_idea', idea_id=idea.id) }}">✏️ Edit</a> |
              <a href="{{ url_for('views.delete_idea', idea_id=idea.id) }}" onclick="return confirm('Are you sure?');">🗑️ Delete</a>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <form method="GET" action="{{ url_for('views.export_ideas') }}" class="export-form">
      <button type="submit" class="export-btn">📤 Export All Ideas to Excel</button>
    </form>
  {% else %}
    <p>No ideas submitted yet.</p>
  {% endif %}
{% endblock %}
